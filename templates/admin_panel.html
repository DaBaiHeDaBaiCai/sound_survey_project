<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>管理面板</title>
  <style>
    body{
      font-family:"Noto Sans SC",system-ui,-apple-system;
      background:#f8fafc;margin:0;padding:0;
    }
    .wrap{max-width:900px;margin:40px auto;padding:0 20px;}
    .card{
      background:#fff;border:1px solid #e5e7eb;border-radius:14px;
      box-shadow:0 6px 14px rgba(0,0,0,.06);padding:20px;margin:18px 0;
    }
    .title{font-weight:700;color:#1f2937;margin-bottom:10px;font-size:18px;}
    .muted{color:#64748b;font-size:14px;line-height:1.6;}
    .row{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;}
    .btn{
      background:#2563eb;color:white;padding:8px 16px;border:none;border-radius:8px;
      font-weight:600;text-decoration:none;font-size:14px;
    }
    .btn:hover{background:#1e40af;cursor:pointer;}
    .btn-outline{
      background:#fff;color:#2563eb;border:1px solid #2563eb;
    }
    .btn-outline:hover{background:#2563eb;color:white;}
    .danger{border-color:#fecaca;background:#fef2f2;}
    .btn-danger{background:#e11d48;}
    .btn-danger:hover{background:#be123c;}
    .flash{
      text-align:center;background:#dcfce7;color:#166534;
      border:1px solid #86efac;padding:10px;border-radius:8px;
      margin-bottom:16px;font-weight:500;
    }
  </style>
  <script>
    function confirmClear(){
      const ok = confirm("确定要清空所有答卷数据吗？此操作不可恢复！");
      if(ok){ document.getElementById('really').value = 'yes'; }
      return ok;
    }
    function confirmDeletePartials(){
      const ok = confirm("删除所有未完成的答卷记录？此操作不可恢复！");
      if(ok){ document.getElementById('deletePartials').value = 'yes'; }
      return ok;
    }
  </script>
</head>
<body>
  <div class="wrap">
    <h1 style="text-align:center;">管理面板</h1>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash">{{ messages[0] }}</div>
      {% endif %}
    {% endwith %}

    <p style="text-align:center;color:#475569;font-size:16px;margin-bottom:20px;">
      已完成答卷：<strong>{{ count }}</strong> 条　
      未完成答卷：<strong style="color:#dc2626;">{{ partial }}</strong> 条
    </p>

    <div class="card">
      <div class="title">导出数据</div>
      <p class="muted">CSV 为完整答卷记录（仅导出已完成），.db 为完整数据库文件。</p>
      <div class="row">
        <a class="btn" href="{{ url_for('export_csv') }}">导出 CSV</a>
        <a class="btn" href="{{ url_for('download_db') }}">下载数据库（.db）</a>
        <a class="btn btn-outline" href="{{ url_for('index') }}">返回首页</a>
        <a class="btn btn-outline" href="{{ url_for('admin_logout') }}">退出登录</a>
      </div>
    </div>

    <div class="card">
      <div class="title">清理未完成记录</div>
      <p class="muted">此操作仅删除未完整提交的答卷，不影响已完成数据。</p>
      <form method="post" action="{{ url_for('delete_partials') }}" onsubmit="return confirmDeletePartials()">
        <input type="hidden" name="really" id="deletePartials" value="">
        <button type="submit" class="btn btn-outline">删除未完成记录</button>
      </form>
    </div>

    <div class="card danger">
      <div class="title" style="color:#b91c1c;">危险操作：清空数据库</div>
      <p class="muted">此操作将删除所有答卷记录，请务必先备份数据库！</p>
      <form method="post" action="{{ url_for('clear_db') }}" onsubmit="return confirmClear()">
        <input type="hidden" name="really" id="really" value="">
        <button type="submit" class="btn btn-danger">清空数据库</button>
      </form>
    </div>

  </div>
</body>
</html>
